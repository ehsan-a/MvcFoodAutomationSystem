@using Domain.Entities
@using FoodAutomationSystem.ViewModels
@model IEnumerable<UserManagementViewModel>

@{
    ViewData["Title"] = "Student Management";
    var students = Model.ToList();
}

<div class="container py-4">

    <!-- HEADER -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
        <div>
            <h2 class="fw-bold text-dark mb-1">Student Management</h2>
            <p class="text-muted mb-0">Manage student accounts and wallet balances</p>
        </div>

        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary rounded-pill px-4 d-flex align-items-center gap-2 shadow-sm">
                <i class="bi bi-download"></i> Export
            </button>
            <button class="btn btn-primary rounded-pill px-4 d-flex align-items-center gap-2 shadow-sm">
                <i class="bi bi-plus-lg"></i> Add Student
            </button>
        </div>
    </div>

    <!-- FILTERS -->
    <form method="get" class="nice-card mb-4 p-4">
        <div class="row g-3 align-items-end">
            <div class="col-lg-8 position-relative">
                <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"></i>
                <input type="text"
                       name="searchQuery"
                       class="form-control ps-5 py-2 rounded-pill shadow-sm border"
                       placeholder="Search by name, email, or student ID..." />
            </div>

            <div class="col-lg-4">
                <button type="submit" class="btn btn-outline-secondary rounded-pill px-4 w-100 shadow-sm d-flex align-items-center justify-content-center gap-2">
                    <i class="bi bi-funnel"></i> More Filters
                </button>
            </div>
        </div>
    </form>

    <!-- STATS CARDS -->
    <div class="row g-4 mb-4">
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="nice-card p-4 text-center">
                <p class="text-muted mb-1">Total Students</p>
                <h4 class="fw-bold text-dark mb-0">@students.Count()</h4>
            </div>
        </div>

        <div class="col-12 col-sm-6 col-lg-3">
            <div class="nice-card p-4 text-center">
                <p class="text-muted mb-1">Active Students</p>
                <h4 class="fw-bold text-dark mb-0">@students.Count(s => s.User.Status == UserStatus.Active)</h4>
            </div>
        </div>

        <div class="col-12 col-sm-6 col-lg-3">
            <div class="nice-card p-4 text-center">
                <p class="text-muted mb-1">Total Wallet Balance</p>
                <h4 class="fw-bold text-dark mb-0">$@students.Sum(s => s.WalletBalance)</h4>
            </div>
        </div>

        <div class="col-12 col-sm-6 col-lg-3">
            <div class="nice-card p-4 text-center">
                <p class="text-muted mb-1">Avg. Balance</p>
                <h4 class="fw-bold text-dark mb-0">$@(students.Any() ? students.Sum(s => s.WalletBalance) / students.Count() : 0)</h4>
            </div>
        </div>
    </div>

    <!-- TABLE -->
    <div class="nice-card overflow-hidden">
        <div class="table-responsive">
            <table class="table modern-table align-middle table-hover mb-0">
                <thead class="table-light">
                    <tr>

                        <th>Student</th>
                        <th>Email</th>
                        <th>Department</th>
                        <th>Wallet</th>
                        <th>Reservations</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var student in students)
                    {
                        <tr>
                            <td class="text-dark fw-semibold">
                                <div>
                                    <p class="fw-bold mb-0">@student.User.FirstName @student.User.LastName</p>
                                    <small class="text-muted">@student.User.Id</small>
                                </div>
                            </td>
                            <td class="text-muted">@student.User.Email</td>
                            <td class="text-muted">-</td>
                            <td>
                                <span class="fw-bold @(
                                      student.WalletBalance > 200 ? "text-success" :
                                      student.WalletBalance > 100 ? "text-warning" :
                                      "text-danger")">
                                    $@student.WalletBalance
                                </span>
                            </td>
                            <td>@student.User.Reservations.Count</td>
                            <td>
                                <span class="pill-badge @(
                                      student.User.Status == UserStatus.Active ? "bg-success text-white" : "bg-secondary text-white")">
                                    @student.User.Status
                                </span>
                            </td>
                            <td>
                                <div class="d-flex gap-2 justify-content-center">
                                    <a href="#" class="btn btn-outline-primary btn-sm rounded-pill px-3">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <a href="#" class="btn btn-outline-danger btn-sm rounded-pill px-3">
                                        <i class="bi bi-trash"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- PAGINATION -->
        <div class="d-flex justify-content-between align-items-center px-4 py-3 bg-light border-top">
            <span class="text-muted small mb-0">Showing 1 to @students.Count() of @students.Count() students</span>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-secondary btn-sm rounded-pill" disabled>Previous</button>
                <button class="btn btn-outline-secondary btn-sm rounded-pill" disabled>Next</button>
            </div>
        </div>
    </div>
</div>

<style>
    /* Cards */
    .nice-card {
        background: #ffffff !important;
        border-radius: 22px !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.04);
        padding: 1.5rem !important;
    }

        /* Stats cards */
        .nice-card.text-center {
            text-align: center;
        }

    /* Table */
    .modern-table {
        border-radius: 16px;
        overflow: hidden;
    }

        .modern-table thead th {
            border-bottom: 2px solid #f0f0f0;
            background: #ffffff;
        }

        .modern-table tbody tr {
            background: #ffffff;
            border-bottom: 1px solid #f3f3f3;
            transition: 0.2s;
        }

            .modern-table tbody tr:hover {
                background: #f7faff !important;
            }

    /* Inputs & selects */
    .form-control,
    .form-select,
    .input-group-text {
        background: #ffffff !important;
        border: 1px solid #e3e3e3 !important;
        border-radius: 20px !important;
    }

    /* Badges */
    .pill-badge {
        padding: 0.35rem 0.7rem;
        border-radius: 20px;
        font-size: 0.85rem;
    }

    /* Hover effect for stats cards */
    .nice-card.text-center:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.07) !important;
    }
</style>
